CREATE TABLE VEHICLE_TYPE(
    ID INT PRIMARY KEY,
    NAME VARCHAR2(100)
);
CREATE TABLE STATION(
    ID INT PRIMARY KEY,
    NAME VARCHAR2(100),
    ADDRESS VARCHAR2(100)
);
CREATE TABLE VEHICLE(
    ID INT PRIMARY KEY,
    VEHICLE_TYPE_ID INT,
    "NUMBER" VARCHAR2(100),
    constraint FK_TYPEID foreign key(VEHICLE_TYPE_ID) references VEHICLE_TYPE(ID) on delete cascade
);
CREATE TABLE TRIP(
    ID INT PRIMARY KEY,
    VEHICLE_ID INT,
    FROMSTATION_ID INT,
    TOSTATION_ID INT,
    constraint FK_VEHICLE_ID foreign key(VEHICLE_ID) references VEHICLE(ID) on delete cascade,
    constraint FK_FROMSTATION_ID foreign key(FROMSTATION_ID) references STATION(ID)on delete cascade,
    constraint FK_TOSTATION_ID foreign key(TOSTATION_ID) references STATION(ID)on delete cascade,
    "Departure time" timestamp,
    "Arrival time" timestamp
);

INSERT INTO VEHICLE_TYPE VALUES (1,'Train');
INSERT INTO VEHICLE_TYPE VALUES (2,'Bus');
INSERT INTO VEHICLE_TYPE VALUES (3,'Train');
INSERT INTO VEHICLE_TYPE VALUES (4,'Train');
INSERT INTO VEHICLE_TYPE VALUES (5,'Bus');
INSERT INTO VEHICLE_TYPE VALUES (6,'Train');
INSERT INTO VEHICLE_TYPE VALUES (7,'Bus');
INSERT INTO VEHICLE_TYPE VALUES (8,'Train');

INSERT INTO VEHICLE VALUES (1,1,'ES523');
INSERT INTO VEHICLE VALUES (2,2,'75');
INSERT INTO VEHICLE VALUES (3,1,'EK888');
INSERT INTO VEHICLE VALUES (4,1,'879');
INSERT INTO VEHICLE VALUES (5,2,'SHUT154');
INSERT INTO VEHICLE VALUES (6,1,'ES899');
INSERT INTO VEHICLE VALUES (7,2,'17568');
INSERT INTO VEHICLE VALUES (8,1,'ES523');

INSERT INTO STATION VALUES (1,'Vilnius train station','Geležinkelio g. 16, Vilnius');
INSERT INTO STATION VALUES (2,'Kaunas bus station','Vytauto pr. 24, Kaunas');
INSERT INTO STATION VALUES (3,'Šiauliai train station','Dubijos g. 42A, Šiauliai');
INSERT INTO STATION VALUES (4,'Klapėda train station','Priestočio g. 1, Klaipėda');
INSERT INTO STATION VALUES (5,'Vilnius bus station','Sodų g. 22, LT-03211 Vilnius');
INSERT INTO STATION VALUES (6,'Kaunas train station','M. K. Čiurlionio g. 16, Kaunas');

INSERT INTO TRIP VALUES (1, 1, 1, 3, TO_TIMESTAMP ('2018-05-02 12:40','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-02 15:08','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (2, 2, 2, 5, TO_TIMESTAMP ('2018-05-04 23:52','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-05 01:04','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (3, 3, 3, 1, TO_TIMESTAMP ('2018-05-08 06:34','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-08 09:36','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (4, 4, 4, 1, TO_TIMESTAMP ('2018-05-10 14:14','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-10 18:23','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (5, 5, 5, 2, TO_TIMESTAMP ('2018-05-09 12:36','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-09 13:28','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (6, 6, 6, 1, TO_TIMESTAMP ('2018-05-29 17:01','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-29 18:50','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (7, 7, 5, 2, TO_TIMESTAMP ('2018-05-28 19:45','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-28 20:58','YYYY-MM-DD HH24:MI'));
INSERT INTO TRIP VALUES (8, 8, 1, 4, TO_TIMESTAMP ('2018-05-25 10:03','YYYY-MM-DD HH24:MI'), TO_TIMESTAMP ('2018-05-25 15:22','YYYY-MM-DD HH24:MI'));

--
SELECT
    TOSTATION.NAME "Arrival station name",
    FROMSTATION.NAME "Departure station name",
    TOSTATION.ADDRESS "Arrival station address",
    FROMSTATION.ADDRESS "Departure station address",
    VEHICLE."NUMBER" "VEHICLE NUMBER",
    "Departure time",
    "Arrival time"
FROM TRIP 
    JOIN STATION TOSTATION ON TRIP.tostation_id = TOSTATION.ID
    JOIN STATION FROMSTATION ON TRIP.fromstation_id = FROMSTATION.ID
    JOIN VEHICLE ON TRIP.VEHICLE_ID = VEHICLE.ID;
    
--
SELECT  
    Vehicle."NUMBER",
    FROMSTATION.ADDRESS "Departure station adress",
    TOSTATION.ADDRESS "Arrival station adress",
    TO_CHAR (EXTRACT (HOUR FROM ("Arrival time" - "Departure time")),'FM00')||':'||TO_CHAR (EXTRACT (MINUTE FROM ("Arrival time" - "Departure time")),'FM00') AS "TRIP TIME"
FROM TRIP
    JOIN STATION FROMSTATION ON TRIP.fromstation_id = FROMSTATION.ID
    JOIN STATION TOSTATION ON TRIP.tostation_id = TOSTATION.ID
    JOIN VEHICLE ON TRIP.VEHICLE_ID = VEHICLE.ID;

--
SELECT STATION.NAME, COUNT(*) AS Isvykimai
FROM TRIP
    JOIN STATION ON TRIP.FROMSTATION_ID = STATION.ID
GROUP BY STATION.NAME
order by count(STATION.NAME);

--
SELECT 
    FROMSTATION.NAME "Departure station name",
    TOSTATION.NAME "Arrival station name",
    FROMSTATION.ADDRESS "Departure station adress",
    TOSTATION.ADDRESS "Arrival station adress",
    VEHICLE."NUMBER" "Vehicle number",
    "Departure time",
    "Arrival time"
FROM TRIP 
    JOIN STATION FROMSTATION ON TRIP.fromstation_id = FROMSTATION.ID
    JOIN STATION TOSTATION ON TRIP.tostation_id = TOSTATION.ID
    JOIN VEHICLE ON TRIP.VEHICLE_ID = VEHICLE.ID
WHERE "Departure time" > '25-MAY-18';

--
DELETE FROM VEHICLE
WHERE
    "NUMBER" = 'ES523';
